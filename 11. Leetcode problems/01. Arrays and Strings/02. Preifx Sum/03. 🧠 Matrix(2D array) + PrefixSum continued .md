
# üìå PREFIX SUM ‚Äì COMPLETE NOTES

---

## 1Ô∏è‚É£ 1D PREFIX SUM (Basic)

### Use when

* Repeated range sum queries on an array
* Problems like: `sum(l, r)`

### Preprocessing

```python
ps[0] = arr[0]
for i in range(1, n):
    ps[i] = ps[i - 1] + arr[i]
```

### Query

```python
sum(l, r) = ps[r] - ps[l - 1]  (if l > 0)
```

### Complexity

* Preprocess: `O(n)`
* Query: `O(1)`
* Space: `O(n)`

---

## 2Ô∏è‚É£ 1D PREFIX SUM WITH PADDING (Cleaner ‚≠ê)

### Why padding?

Avoid boundary checks (`l > 0`)

### Preprocessing

```python
ps = [0] * (n + 1)
for i in range(n):
    ps[i + 1] = ps[i] + arr[i]
```

### Query

```python
sum(l, r) = ps[r + 1] - ps[l]
```

‚úîÔ∏è Preferred in interviews

---

## 3Ô∏è‚É£ 2D PREFIX SUM (Matrix / Rectangle Queries)

### Use when

* Sum of submatrices
* Problems like:

  * LeetCode 304
  * Matrix region sum

---

### Definition

```
ps[r][c] = sum of matrix[0..r][0..c]
```

---

### Preprocessing

```python
for r in range(rows):
    for c in range(cols):
        ps[r][c] = matrix[r][c]
        if r > 0:
            ps[r][c] += ps[r - 1][c]
        if c > 0:
            ps[r][c] += ps[r][c - 1]
        if r > 0 and c > 0:
            ps[r][c] -= ps[r - 1][c - 1]
```

---

### Query (Inclusion‚ÄìExclusion)

```python
sum = ps[r2][c2]
if r1 > 0:
    sum -= ps[r1 - 1][c2]
if c1 > 0:
    sum -= ps[r2][c1 - 1]
if r1 > 0 and c1 > 0:
    sum += ps[r1 - 1][c1 - 1]
```

---

### Complexity

* Preprocess: `O(m √ó n)`
* Query: `O(1)`
* Space: `O(m √ó n)`

---

## 4Ô∏è‚É£ 2D PREFIX SUM WITH PADDING (BEST PRACTICE ‚≠ê)

### Why padding?

No boundary checks = clean code

### Preprocessing

```python
ps = [[0] * (cols + 1) for _ in range(rows + 1)]

for r in range(rows):
    for c in range(cols):
        ps[r + 1][c + 1] = (
            matrix[r][c]
            + ps[r][c + 1]
            + ps[r + 1][c]
            - ps[r][c]
        )
```

### Query

```python
sum = (
    ps[r2 + 1][c2 + 1]
    - ps[r1][c2 + 1]
    - ps[r2 + 1][c1]
    + ps[r1][c1]
)
```

‚úîÔ∏è Cleanest version
‚úîÔ∏è Highly recommended

---

## 5Ô∏è‚É£ ROW-WISE PREFIX SUM (Partial 2D)

### Use when

* Only horizontal ranges
* Each query spans multiple rows but same columns

### Preprocessing

```python
for r in range(rows):
    for c in range(1, cols):
        matrix[r][c] += matrix[r][c - 1]
```

### Query

```python
sum = 0
for r in range(r1, r2 + 1):
    sum += matrix[r][c2] - matrix[r][c1 - 1]
```

### Complexity

* Query: `O(rows)` ‚ùå (slower)
* Not good for many queries

---

## 6Ô∏è‚É£ PREFIX SUM + HASHMAP (Subarray Problems ‚≠ê)

### Use when

* Subarray sum equals `k`
* Count subarrays
* Can have negatives

### Pattern

```python
count = 0
curr_sum = 0
seen = {0: 1}

for num in arr:
    curr_sum += num
    count += seen.get(curr_sum - k, 0)
    seen[curr_sum] = seen.get(curr_sum, 0) + 1
```

### Used in

* LeetCode 560
* Zero-sum subarrays
* Balanced subarrays

---

## 7Ô∏è‚É£ DIFFERENCE ARRAY (Range Updates)

### Use when

* Many range updates
* Final array needed

### Update

```python
diff[l] += val
diff[r + 1] -= val
```

### Build final array

```python
for i in range(1, n):
    diff[i] += diff[i - 1]
```

---

## 8Ô∏è‚É£ PREFIX XOR (Bitwise Problems)

### Use when

* XOR range queries
* XOR subarrays

### Preprocessing

```python
px[0] = 0
for num in arr:
    px.append(px[-1] ^ num)
```

### Query

```python
xor(l, r) = px[r + 1] ^ px[l]
```

---

## 9Ô∏è‚É£ KEY INTERVIEW TAKEAWAYS ‚≠ê‚≠ê‚≠ê

* **Prefix sum = precompute once, answer fast**
* **Padding removes edge-case bugs**
* **2D prefix sum = inclusion‚Äìexclusion**
* **HashMap + prefix sum handles negatives**
* **Difference array = reverse prefix sum**

---

## üîë Cheat Sheet

| Problem Type      | Technique        |
| ----------------- | ---------------- |
| Range sum queries | 1D prefix        |
| Rectangle sum     | 2D prefix        |
| Subarray sum = k  | Prefix + hashmap |
| Range updates     | Difference array |
| XOR ranges        | Prefix XOR       |

